---
import Layout from '../layouts/Layout.astro';
import CodecScreen from '../components/CodecScreen.astro';
import StatusThermometer from '../components/StatusThermometer.astro';
import FallenCoaches from '../components/FallenCoaches.astro';
import GTATimer from '../components/GTATimer';
import statusData from '../data/status.json';

const { coach, opponent, status, recentResults, fallenCoaches } = statusData;

// Calculate days since start
const startDate = new Date(coach.startDate);
const now = new Date();
const currentDays = Math.floor((now.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));

// Icon mapping
const getResultIcon = (result: string) => {
    if (result === 'W') return '‚úÖ';
    if (result === 'L') return 'üíÄ';
    return '‚ö†Ô∏è';
};

const pageTitle = `üëë REALTRONO ‚Äî ${coach.name.toUpperCase()} | ${currentDays} d√≠as en el trono`;
---

<Layout title={pageTitle}>
	<main class="min-h-screen flex flex-col items-center p-2 sm:p-4 pb-20 relative overflow-hidden">
        
        <!-- Background Effects -->
        <div class="scanline-moving"></div>
        
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 1: ESTADO PRINCIPAL + D√çAS (Mobile First, Above the fold) -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-lg mx-auto mb-8">
            
            <!-- STATUS BADGE - Lo primero que ve el usuario -->
            <div class="text-center mb-6">
                <div class={`
                    inline-flex items-center gap-3 px-6 py-3 border-2
                    ${status.level === 4 ? 'border-red-500 bg-red-500/10 animate-pulse' : ''}
                    ${status.level === 3 ? 'border-orange-500 bg-orange-500/10' : ''}
                    ${status.level === 2 ? 'border-yellow-500 bg-yellow-500/10' : ''}
                    ${status.level === 1 ? 'border-green-500 bg-green-500/10' : ''}
                    ${status.level === 5 ? 'border-gray-500 bg-gray-500/10' : ''}
                `}>
                    <span class="text-2xl">
                        {status.level === 1 && 'üõ°Ô∏è'}
                        {status.level === 2 && 'üòé'}
                        {status.level === 3 && 'üëÄ'}
                        {status.level === 4 && '‚ö†Ô∏è'}
                        {status.level === 5 && 'üíÄ'}
                    </span>
                    <span class={`
                        font-['Press_Start_2P'] text-sm sm:text-base tracking-wide
                        ${status.level === 4 ? 'text-red-400' : ''}
                        ${status.level === 3 ? 'text-orange-400' : ''}
                        ${status.level === 2 ? 'text-yellow-400' : ''}
                        ${status.level === 1 ? 'text-green-400' : ''}
                        ${status.level === 5 ? 'text-gray-400' : ''}
                    `}>
                        {status.levelName}
                    </span>
                </div>
            </div>
            
            <!-- D√çAS COUNTER - Grande y prominente -->
            <div class="relative border-2 border-codec-green bg-codec-dark/90 p-6 text-center mb-4">
                <!-- Corner decorations -->
                <div class="absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-codec-green"></div>
                <div class="absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-codec-green"></div>
                <div class="absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-codec-green"></div>
                <div class="absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-codec-green"></div>
                
                <p class="text-[10px] text-codec-green/60 tracking-[0.3em] uppercase mb-2">
                    D√≠as en el Trono
                </p>
                <div class="font-['Press_Start_2P'] text-6xl sm:text-7xl md:text-8xl text-codec-green text-glow tabular-nums leading-none">
                    {currentDays}
                </div>
                <p class="text-xs text-codec-green/40 mt-3">
                    Desde el {startDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}
                </p>
            </div>
            
            <!-- NOMBRE DEL ENTRENADOR -->
            <div class="text-center">
                <p class="text-[10px] text-codec-green/40 tracking-widest mb-1">{coach.nickname?.toUpperCase() || 'M√çSTER'}</p>
                <h1 class="font-['Press_Start_2P'] text-lg sm:text-xl text-codec-green text-glow tracking-wide">
                    {coach.name.toUpperCase()}
                </h1>
            </div>
            
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 2: BARRA DE VIDA / ENERG√çA -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-lg mx-auto mb-8">
            <div class="border border-codec-green/40 bg-codec-dark/80 p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-[10px] text-codec-green/60 tracking-widest">LIFE</span>
                    <span class="font-mono text-sm text-codec-green">{status.lifePercent}%</span>
                </div>
                <div class="w-full h-6 bg-black border border-codec-green/40 relative overflow-hidden">
                    <!-- Segmented bar -->
                    <div 
                        class={`
                            h-full transition-all duration-1000 relative
                            ${status.lifePercent > 60 ? 'bg-green-500' : ''}
                            ${status.lifePercent > 40 && status.lifePercent <= 60 ? 'bg-yellow-500' : ''}
                            ${status.lifePercent > 20 && status.lifePercent <= 40 ? 'bg-orange-500' : ''}
                            ${status.lifePercent <= 20 ? 'bg-red-500 animate-pulse' : ''}
                        `}
                        style={`width: ${status.lifePercent}%`}
                    >
                        <!-- Segmented overlay -->
                        <div class="absolute inset-0 flex">
                            {Array.from({ length: 20 }).map(() => (
                                <div class="flex-1 border-r border-black/40"></div>
                            ))}
                        </div>
                    </div>
                </div>
                {status.lifePercent <= 25 && (
                    <p class="text-[10px] text-red-400 mt-2 animate-pulse text-center tracking-widest">
                        ‚ö†Ô∏è CRITICAL - DANGER ZONE ‚ö†Ô∏è
                    </p>
                )}
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 3: TERM√ìMETRO DETALLADO -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-lg mx-auto mb-8">
            <StatusThermometer 
                currentLevel={status.level} 
                statusName={status.levelName}
            />
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 4: PR√ìXIMO PARTIDO (Countdown) -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-5xl mx-auto mb-8">
            <div class="text-center mb-4">
                <span class="text-[10px] text-codec-green/40 tracking-[0.3em]">PR√ìXIMA BATALLA</span>
            </div>
            <GTATimer 
                client:load 
                targetDate={coach.startDate} 
                isCountdown={false}
                title="" 
            />
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 5: CODEC SCREEN (Imagen del entrenador) -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-4xl mx-auto mb-8">
            <CodecScreen 
                coachImage={coach.image}
                coachName={coach.name.toUpperCase()}
                opponentImage={opponent.image}
                opponentName={opponent.name.toUpperCase()}
                statusLevel={status.lifePercent}
                coachStartDate={coach.startDate}
                matchDate={opponent.date}
                homeTeam={{ 
                    name: "Real Madrid", 
                    logo: "https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/1200px-Real_Madrid_CF.svg.png" 
                }}
                awayTeam={{ 
                    name: opponent.name, 
                    logo: opponent.image 
                }}
            >
                <!-- HUD RESULTS -->
                <div slot="results-mini" class="flex flex-col gap-1">
                    {recentResults.map((match) => (
                        <div class="flex items-center gap-2 text-[10px] font-mono">
                            <span class="text-xs">{getResultIcon(match.result)}</span>
                            <span class="text-codec-green font-bold truncate max-w-[80px]">{match.opponent}</span>
                            <span class="text-codec-green/40">[{match.score}]</span>
                        </div>
                    ))}
                </div>

                <!-- RIVAL RESULTS -->
                <div slot="rival-results" class="flex flex-col gap-1">
                    {opponent.recentResults.slice(0, 3).map((match) => (
                        <div class="flex items-center gap-2 text-[10px] font-mono text-codec-green/80">
                            <span>{getResultIcon(match.result)}</span>
                            <span class="truncate max-w-[70px]">{match.opponent}</span>
                            <span class="text-[8px] opacity-40">{match.score}</span>
                        </div>
                    ))}
                </div>

                <!-- BOTTOM SUBTITLES -->
                <div slot="subtitles" class="flex flex-col items-center gap-2">
                    <p class="text-lg sm:text-xl text-codec-green font-bold text-glow uppercase tracking-[0.1em] leading-tight max-w-2xl text-center">
                        {status.description}
                    </p>
                    <div class="w-12 h-[1px] bg-codec-green/20 my-2"></div>
                    <p class="text-xs sm:text-sm text-codec-green/60 font-mono italic max-w-xl text-center">
                        "{status.subtext}"
                    </p>
                </div>
            </CodecScreen>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 6: COMPARADOR HIST√ìRICO (Ca√≠dos del Trono) -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-lg mx-auto mb-8">
            <FallenCoaches 
                currentDays={currentDays}
                fallenCoaches={fallenCoaches}
            />
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- SECCI√ìN 7: CTAs -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="w-full max-w-lg mx-auto">
            <div class="flex flex-wrap justify-center gap-4">
                <button class="codec-panel px-6 py-3 text-sm font-bold tracking-widest hover:bg-codec-green hover:text-black transition-all duration-300">
                    üìä VOTAR STATUS
                </button>
                <button class="codec-panel px-6 py-3 text-sm font-bold tracking-widest hover:bg-codec-green hover:text-black transition-all duration-300">
                    üì§ COMPARTIR
                </button>
            </div>
        </section>

	</main>
</Layout>

<style>
    .text-shadow {
        text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.8);
    }
</style>
