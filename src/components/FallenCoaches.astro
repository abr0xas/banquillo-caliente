---
interface Coach {
    name: string;
    days: number;
    year: string;
    reason: string;
}

interface Props {
    currentDays: number;
    fallenCoaches: Coach[];
}

const { currentDays, fallenCoaches } = Astro.props;

// Sort by days (shortest first)
const sortedCoaches = [...fallenCoaches].sort((a, b) => a.days - b.days);

// Find where current coach would rank
const currentRank = sortedCoaches.filter(c => c.days < currentDays).length + 1;
---

<div class="w-full max-w-md mx-auto">
    <!-- HEADER -->
    <div class="flex items-center justify-between mb-4 border-b border-codec-green/30 pb-3">
        <div class="flex items-center gap-2">
            <span class="text-xl">üíÄ</span>
            <span class="font-['Press_Start_2P'] text-[10px] sm:text-xs text-codec-green tracking-wide">
                CA√çDOS DEL TRONO
            </span>
        </div>
        <span class="text-[10px] text-codec-green/40 tracking-widest">
            HISTORIAL
        </span>
    </div>

    <!-- CURRENT COACH COMPARISON -->
    <div class="mb-4 p-3 border-2 border-codec-green bg-codec-green/10 relative">
        <div class="absolute -top-2 left-3 px-2 bg-codec-dark">
            <span class="text-[8px] text-codec-green tracking-widest">ACTUAL</span>
        </div>
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="text-2xl">üëë</span>
                <div>
                    <span class="font-['Press_Start_2P'] text-[10px] text-codec-green">ARBELOA</span>
                    <p class="text-[9px] text-codec-green/60 mt-0.5">En el cargo</p>
                </div>
            </div>
            <div class="text-right">
                <span class="font-['Press_Start_2P'] text-xl sm:text-2xl text-codec-green text-glow tabular-nums">
                    {currentDays}
                </span>
                <p class="text-[9px] text-codec-green/60">d√≠as</p>
            </div>
        </div>
        
        <!-- Progress to next fallen coach -->
        {sortedCoaches.length > 0 && currentDays < sortedCoaches[0].days && (
            <div class="mt-3 pt-3 border-t border-codec-green/30">
                <div class="flex justify-between text-[9px] text-codec-green/60 mb-1">
                    <span>Pr√≥ximo r√©cord a superar:</span>
                    <span>{sortedCoaches[0].name} ({sortedCoaches[0].days} d√≠as)</span>
                </div>
                <div class="w-full h-2 bg-codec-dark border border-codec-green/30 overflow-hidden">
                    <div 
                        class="h-full bg-codec-green transition-all duration-1000"
                        style={`width: ${Math.min(100, (currentDays / sortedCoaches[0].days) * 100)}%`}
                    ></div>
                </div>
                <p class="text-[8px] text-codec-green/40 mt-1 text-right">
                    {sortedCoaches[0].days - currentDays} d√≠as para superar
                </p>
            </div>
        )}
    </div>

    <!-- FALLEN COACHES LIST -->
    <div class="space-y-2">
        {sortedCoaches.map((coach, index) => {
            const isBeaten = currentDays > coach.days;
            
            return (
                <div 
                    class={`
                        relative flex items-center gap-3 p-3 border transition-all duration-300
                        ${isBeaten 
                            ? 'border-codec-green/20 bg-codec-dark/50 opacity-50' 
                            : 'border-codec-green/40 bg-codec-dark/80 hover:bg-codec-green/5'
                        }
                    `}
                >
                    <!-- Rank -->
                    <div class={`
                        w-6 h-6 flex items-center justify-center text-[10px] font-bold border
                        ${isBeaten 
                            ? 'border-codec-green/20 text-codec-green/30' 
                            : 'border-codec-green/60 text-codec-green'
                        }
                    `}>
                        {index + 1}
                    </div>
                    
                    <!-- Coach info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <span class={`
                                font-['Press_Start_2P'] text-[8px] sm:text-[10px]
                                ${isBeaten ? 'text-codec-green/40 line-through' : 'text-codec-green'}
                            `}>
                                {coach.name}
                            </span>
                            {isBeaten && (
                                <span class="text-[7px] px-1 py-0.5 bg-codec-green/20 text-codec-green/60">
                                    SUPERADO
                                </span>
                            )}
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-[9px] text-codec-green/40">{coach.year}</span>
                            <span class="text-[8px] text-codec-green/30">‚Ä¢</span>
                            <span class="text-[9px] text-codec-green/40 truncate">{coach.reason}</span>
                        </div>
                    </div>
                    
                    <!-- Days -->
                    <div class="text-right shrink-0">
                        <span class={`
                            font-mono text-lg sm:text-xl font-bold tabular-nums
                            ${isBeaten ? 'text-codec-green/30' : 'text-codec-green text-glow-sharp'}
                        `}>
                            {coach.days}
                        </span>
                        <p class="text-[8px] text-codec-green/40">d√≠as</p>
                    </div>
                    
                    <!-- Beaten indicator -->
                    {isBeaten && (
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <span class="text-4xl opacity-10">‚úì</span>
                        </div>
                    )}
                </div>
            );
        })}
    </div>
    
    <!-- FOOTER STATS -->
    <div class="mt-4 pt-3 border-t border-codec-green/20 flex justify-between items-center">
        <div class="text-[9px] text-codec-green/40">
            <span class="text-codec-green">{sortedCoaches.filter(c => currentDays > c.days).length}</span>
            /{sortedCoaches.length} r√©cords superados
        </div>
        <div class="text-[9px] text-codec-green/40">
            Ranking actual: <span class="text-codec-green font-bold">#{currentRank}</span>
        </div>
    </div>
</div>
