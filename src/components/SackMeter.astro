---
interface Props {
  level: number; // 0 to 100
}

const { level } = Astro.props;

// Calculate rotation for the needle (-90deg to 90deg)
const rotation = (level / 100) * 180 - 90;
const isDanger = level > 80;
---

<div class="relative w-64 h-32 mx-auto overflow-hidden">
    <!-- Gauge Background -->
    <div class="absolute bottom-0 w-full h-full bg-gray-200 dark:bg-gray-700 rounded-t-full"></div>
    
    <!-- Gauge Gradient (Safe -> Danger) -->
    <div class="absolute bottom-0 w-full h-full rounded-t-full opacity-30"
         style="background: conic-gradient(from 180deg at 50% 100%, #22c55e 0deg, #eab308 90deg, #ef4444 180deg);">
    </div>

    <!-- Needle Wrapper -->
    <div class="absolute bottom-0 left-1/2 w-full h-[2px] -ml-full origin-bottom-right transition-transform duration-1000 ease-out"
         style={`transform: rotate(${rotation}deg); width: 50%; transform-origin: center bottom; bottom: 0; left: 0;`}>
        <div class="absolute right-0 bottom-0 w-full h-[4px] bg-black dark:bg-white rounded-l-full"></div>
         <!-- Needle Tip (Circle at center) -->
         <div class="absolute right-[-6px] bottom-[-4px] w-4 h-4 rounded-full bg-black dark:bg-white border-2 border-gray-100"></div>
    </div>
</div>

<div class="text-center mt-4">
    <p class={`text-4xl font-display font-black ${isDanger ? 'text-crisis-red animate-shake' : 'text-gray-800 dark:text-gray-200'}`}>
        {level}%
    </p>
    <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mt-1">Probabilidad de Despido</p>
</div>

<style>
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-2px); }
        75% { transform: translateX(2px); }
    }
    .animate-shake {
        animation: shake 0.5s infinite;
    }
</style>
